{
  "permissions": {
    "allow": [
      "Bash(dotnet list:*)",
      "Bash(dotnet add:*)",
      "Bash(dotnet build:*)",
      "Bash(git rm:*)",
      "WebFetch(domain:docs.umbraco.com)",
      "WebFetch(domain:github.com)",
      "Bash(git checkout:*)",
      "Bash(cat:*)",
      "Bash(git add:*)",
      "Bash(git commit -m \"$(cat <<''EOF''\nMigrate Umbraco Cloud CI/CD from v1 to v2 API\n\nThis commit migrates the CI/CD pipeline from Umbraco Cloud API v1 to v2,\nbringing improved artifact management and multi-environment support.\n\nKey Changes:\n- Replace all v1 PowerShell scripts with v2 versions\n- Add new cloud-artifact.yml workflow for decoupled artifact upload\n- Update cloud-deployment.yml to v2 (requires artifactId input)\n- Update cloud-sync.yml to v2 (preserve custom git config)\n- Re-enable all workflows in main.yml (build, sync, artifact, deploy)\n- Add comprehensive migration documentation\n\nNew Features:\n- Explicit environment targeting via TARGET_ENVIRONMENT_ALIAS variable\n- Artifact upload separated from deployment for reusability\n- Enhanced deployment options (noBuildAndRestore, skipVersionCheck)\n\nConfiguration Required:\n- GitHub repository variable: TARGET_ENVIRONMENT_ALIAS = \"live\"\n- Existing secrets remain unchanged\n\nCustom Settings Preserved:\n- Git user config for cloud sync commits:\n  - Name: \"Umbraco Cloud Github Sync\"\n  - Email: \"github-actions@h-madsen.dk\"\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(git push:*)",
      "Bash(gh pr create:*)",
      "Bash(export PATH=\"$PATH:/c/Program Files/GitHub CLI\")",
      "Bash(gh --version:*)",
      "Bash(where:*)",
      "Bash(/c/Program Files/GitHub CLI/gh.exe --version)",
      "Bash(\"/c/Program Files/GitHub CLI/gh.exe\" pr create --title \"Migrate Umbraco Cloud CI/CD from v1 to v2 API\" --body \"$(cat <<''EOF''\n## Summary\n\nThis PR migrates the CI/CD pipeline from Umbraco Cloud API v1 to v2, bringing improved artifact management, multi-environment support, and better deployment flexibility.\n\n## Key Changes\n\n### ðŸ”„ API Migration\n- **From**: Umbraco Cloud CI/CD Flow API v1\n- **To**: Umbraco Cloud CI/CD Flow API v2\n\n### ðŸ“ Files Changed (14 files, +719/-329 lines)\n\n**PowerShell Scripts:**\n- âŒ Deleted 2 v1 scripts (`Add-DeploymentPackage.ps1`, `New-Deployment.ps1`)\n- âœ… Added 2 new v2 scripts (`Add-DeploymentArtifact.ps1`, `Apply-Patch.ps1`)\n- ðŸ”„ Updated 4 existing scripts to v2 versions\n\n**GitHub Workflows:**\n- âœ… Added: `cloud-artifact.yml` - New workflow for decoupled artifact upload\n- ðŸ”„ Updated: `cloud-deployment.yml` - Now requires `artifactId` input\n- ðŸ”„ Updated: `cloud-sync.yml` - V2 version with preserved custom git config\n- ðŸ”„ Updated: `main.yml` - Re-enabled all workflows (build, sync, artifact, deploy)\n\n**Documentation:**\n- ðŸ“ Added: `.github/CICD_V2_MIGRATION.md` - Comprehensive migration guide\n\n### âœ¨ New Features in V2\n\n1. **Multi-environment targeting**: Explicit deployment to ''live'' environment via `TARGET_ENVIRONMENT_ALIAS`\n2. **Decoupled artifact management**: Upload artifact once, deploy multiple times if needed\n3. **Better deployment control**: New options for `noBuildAndRestore` and `skipVersionCheck`\n4. **Improved API structure**: More RESTful design with better separation of concerns\n\n### ðŸ”§ Configuration Required\n\n**âš ï¸ IMPORTANT: Before merging, add this GitHub repository variable:**\n\n1. Navigate to: Settings â†’ Security â†’ Secrets and variables â†’ Actions â†’ **Variables** tab\n2. Click \"New repository variable\"\n3. Set:\n   - **Name**: `TARGET_ENVIRONMENT_ALIAS`\n   - **Value**: `live`\n\n**Existing secrets remain unchanged:**\n- âœ… `UMBRACO_CLOUD_PROJECT_ID`\n- âœ… `UMBRACO_CLOUD_CICD_API_KEY`\n\n### ðŸŽ¯ Workflow Changes\n\n**Old v1 flow:**\n```\nBuild â†’ Cloud Sync â†’ Cloud Deployment\n```\n\n**New v2 flow:**\n```\nBuild â†’ Cloud Sync â†’ Upload Artifact â†’ Deploy to Cloud\n          â†“              â†“                 â†“\n       (checks)    (get artifactId)  (deploy to ''live'')\n```\n\n### âœ… Preserved Customizations\n\n- Custom git user configuration for cloud sync commits:\n  - Name: `Umbraco Cloud Github Sync`\n  - Email: `github-actions@h-madsen.dk`\n\n### ðŸ§ª Testing Plan\n\n- [x] All v1 scripts replaced with v2 versions\n- [x] Custom git configuration preserved\n- [x] All workflows re-enabled in main.yml\n- [x] Documentation created\n- [ ] Add `TARGET_ENVIRONMENT_ALIAS` variable\n- [ ] Test build workflow execution\n- [ ] Test cloud sync functionality\n- [ ] Test artifact upload\n- [ ] Test deployment to ''live'' environment\n- [ ] Verify application in Umbraco Cloud\n\n### ðŸ“š Documentation\n\nFull migration details are available in `.github/CICD_V2_MIGRATION.md` including:\n- Complete file-by-file breakdown\n- Configuration requirements\n- Testing recommendations\n- Rollback procedure (v1 API still works!)\n\n### ðŸ”™ Rollback\n\nIf issues arise, the v1 API remains supported with no deprecation timeline. Simply revert this PR to restore v1 functionality.\n\n### ðŸ“– References\n\n- [Umbraco CI/CD Documentation](https://docs.umbraco.com/umbraco-cloud/build-and-customize-your-solution/handle-deployments-and-environments/umbraco-cicd)\n- [Migration Guide](https://docs.umbraco.com/umbraco-cloud/build-and-customize-your-solution/handle-deployments-and-environments/umbraco-cicd/samplecicdpipeline/migrate)\n- [Sample Repository](https://github.com/umbraco/Umbraco.Cloud.CICDFlow.Samples)\n\n---\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\nEOF\n)\" --base main --head feature/cicd-v2-migration)",
      "Bash(git commit:*)"
    ],
    "deny": [],
    "ask": []
  }
}
